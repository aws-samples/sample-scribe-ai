# events function handler

Async processing for interview workflows

## workflow

### End Interview
- update status to `processing`
- SQS.SendMessage(`interview_complete`, interview_id)

### event: interview_complete
- check interview status is `processing`
- bedrock invoke
- update status to `pendingreview`

### Approve Button
- update status to `pendingapproval`
- SQS.SendMessage(`interview_approved`, interview_id)

### event: interview_approved
- check interview status is `pendingapproval`
- bedrock invoke
- update status to `approved`

## Project Structure

```
.
├── events/                   # Event handlers
│   ├── __init__.py
│   ├── event_processor.py    # Main event processing logic
│   ├── interview_complete.py # Handler for interview_complete events
│   └── interview_approved.py # Handler for interview_approved events
├── lambda_function.py        # AWS Lambda entry point
└── main.py                   # Local testing entry point
```

### Test in python
```sh
make start
```

### Test in container

```sh
# start the lambda in a container
make up
```
```sh
# run the test script
export $(cat .env | grep -v '^#' | xargs) && python -u main.py <interview_id> <event_type>
```
example
```sh
# run the test script
export $(cat .env | grep -v '^#' | xargs) && python -u main.py ef9cf079-c4e8-46d6-aad8-84d4f2738ec7 approved
```
```sh
make down
```


## Development
```
 Choose a make command to run

  init              initialize a new python project
  install           add a new package (make install <package>), or install all project dependencies from piplock.txt (make install)
  start             run local project
  build-container   package app for aws lambda using container
  start-container   run local project in container
  up                run the app locally using docker compose
  down              stop the app
  deploy            build and deploy container (make deploy app=scribe-events)
```

Generated by https://github.com/jritsema/cookiecutter-python
